{"version":3,"sources":["BaseComponent.ts"],"names":[],"mappings":"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","file":"BaseComponent.js","sourcesContent":["import * as React from 'react';\r\nimport { Async } from './Async';\r\nimport { EventGroup } from './EventGroup';\r\nimport { IDisposable } from './IDisposable';\r\nimport { warnDeprecations, warnMutuallyExclusive, ISettingsMap } from './warn';\r\n\r\nexport interface IBaseProps {\r\n  componentRef?: any;\r\n}\r\n\r\nexport class BaseComponent<P extends IBaseProps, S> extends React.Component<P, S> {\r\n  /**\r\n   * External consumers should override BaseComponent.onError to hook into error messages that occur from\r\n   * exceptions thrown from within components.\r\n   */\r\n  public static onError: ((errorMessage?: string, ex?: any) => void);\r\n\r\n  /**\r\n   * Controls whether the componentRef prop will be resolved by this component instance. If you are\r\n   * implementing a passthrough (higher-order component), you would set this to false and pass through\r\n   * the props to the inner component, allowing it to resolve the componentRef.\r\n   *\r\n   * @protected\r\n   * @type {boolean}\r\n   * @memberOf BaseComponent\r\n   */\r\n  protected _shouldUpdateComponentRef: boolean;\r\n\r\n  private __async: Async;\r\n  private __events: EventGroup;\r\n  private __disposables: IDisposable[];\r\n  private __resolves: { [name: string]: (ref: any) => any };\r\n  private __className: string;\r\n\r\n  /**\r\n   * BaseComponent constructor\r\n   * @param {P} props The props for the component.\r\n   * @param {Object} context The context for the component.\r\n   * value is the new name. If a prop is removed rather than renamed, leave the value undefined.\r\n   */\r\n  constructor(props?: P, context?: any) {\r\n    super(props, context);\r\n\r\n    this.props = props;\r\n    this._shouldUpdateComponentRef = true;\r\n\r\n    _makeAllSafe(this, BaseComponent.prototype, [\r\n      'componentWillMount',\r\n      'componentDidMount',\r\n      'shouldComponentUpdate',\r\n      'componentWillUpdate',\r\n      'componentWillReceiveProps',\r\n      'render',\r\n      'componentDidUpdate',\r\n      'componentWillUnmount'\r\n    ]);\r\n  }\r\n\r\n  /** When the component will receive props, make sure the componentRef is updated. */\r\n  public componentWillReceiveProps(newProps?: P, newContext?: any) {\r\n    this._updateComponentRef(this.props, newProps);\r\n  }\r\n\r\n  /** When the component has mounted, update the componentRef. */\r\n  public componentDidMount() {\r\n    this._updateComponentRef(undefined, this.props);\r\n  }\r\n\r\n  /** If we have disposables, dispose them automatically on unmount. */\r\n  public componentWillUnmount() {\r\n    if (this.__disposables) {\r\n      for (let i = 0, len = this._disposables.length; i < len; i++) {\r\n        let disposable = this.__disposables[i];\r\n\r\n        if (disposable.dispose) {\r\n          disposable.dispose();\r\n        }\r\n      }\r\n      this.__disposables = null;\r\n    }\r\n  }\r\n\r\n  /** Gets the object's class name. */\r\n  public get className() {\r\n    if (!this.__className) {\r\n      let funcNameRegex = /function (.{1,})\\(/;\r\n      let results = (funcNameRegex).exec((this).constructor.toString());\r\n\r\n      this.__className = (results && results.length > 1) ? results[1] : '';\r\n    }\r\n\r\n    return this.__className;\r\n  }\r\n\r\n  /** Allows subclasses to push things to this._disposables to be auto disposed. */\r\n  protected get _disposables(): IDisposable[] {\r\n    if (!this.__disposables) {\r\n      this.__disposables = [];\r\n    }\r\n    return this.__disposables;\r\n  }\r\n\r\n  /**\r\n   * Gets the async instance associated with the component, created on demand. The async instance gives\r\n   * subclasses a way to execute setTimeout/setInterval async calls safely, where the callbacks\r\n   * will be cleared/ignored automatically after unmounting. The helpers within the async object also\r\n   * preserve the this pointer so that you don't need to \"bind\" the callbacks.\r\n   */\r\n  protected get _async(): Async {\r\n    if (!this.__async) {\r\n      this.__async = new Async(this);\r\n      this._disposables.push(this.__async);\r\n    }\r\n\r\n    return this.__async;\r\n  }\r\n\r\n  /**\r\n   * Gets the event group instance assocaited with the component, created on demand. The event instance\r\n   * provides on/off methods for listening to DOM (or regular javascript object) events. The event callbacks\r\n   * will be automatically disconnected after unmounting. The helpers within the events object also\r\n   * preserve the this reference so that you don't need to \"bind\" the callbacks.\r\n   */\r\n  protected get _events(): EventGroup {\r\n    if (!this.__events) {\r\n      this.__events = new EventGroup(this);\r\n      this._disposables.push(this.__events);\r\n    }\r\n\r\n    return this.__events;\r\n  }\r\n\r\n  /**\r\n   * Helper to return a memoized ref resolver function.\r\n   * @params refName Name of the member to assign the ref to.\r\n   *\r\n   * @examples\r\n   * class Foo extends BaseComponent<...> {\r\n   *   private _root: HTMLElement;\r\n   *\r\n   *   public render() {\r\n   *     return <div ref={ this._resolveRef('_root') } />\r\n   *   }\r\n   * }\r\n   */\r\n  protected _resolveRef(refName: string) {\r\n    if (!this.__resolves) {\r\n      this.__resolves = {};\r\n    }\r\n    if (!this.__resolves[refName]) {\r\n      this.__resolves[refName] = (ref) => {\r\n        return this[refName] = ref;\r\n      };\r\n    }\r\n\r\n    return this.__resolves[refName];\r\n  }\r\n\r\n  /**\r\n   * Updates the componentRef (by calling it with \"this\" when necessary.)\r\n   */\r\n  protected _updateComponentRef(currentProps: IBaseProps, newProps: IBaseProps = {}) {\r\n    if (this._shouldUpdateComponentRef &&\r\n      ((!currentProps && newProps.componentRef) ||\r\n        (currentProps && currentProps.componentRef !== newProps.componentRef))) {\r\n\r\n      if (currentProps && currentProps.componentRef) {\r\n        currentProps.componentRef(null);\r\n      }\r\n\r\n      if (newProps.componentRef) {\r\n        newProps.componentRef(this);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * Warns when a deprecated props are being used.\r\n   *\r\n   * @protected\r\n   * @param {ISettingsMap<P>} deprecationMap The map of deprecations, where key is the prop name and the value is\r\n   * either null or a replacement prop name.\r\n   *\r\n   * @memberOf BaseComponent\r\n   */\r\n  protected _warnDeprecations(deprecationMap: ISettingsMap<P>) {\r\n    warnDeprecations(this.className, this.props, deprecationMap);\r\n  }\r\n\r\n  /**\r\n   * Warns when props which are mutually exclusive with each other are both used.\r\n   *\r\n   * @protected\r\n   * @param {ISettingsMap<P>} mutuallyExclusiveMap The map of mutually exclusive props.\r\n   *\r\n   * @memberOf BaseComponent\r\n   */\r\n  protected _warnMutuallyExclusive(mutuallyExclusiveMap: ISettingsMap<P>) {\r\n    warnMutuallyExclusive(this.className, this.props, mutuallyExclusiveMap);\r\n  }\r\n}\r\n\r\n/**\r\n * Helper to override a given method with a wrapper method that can try/catch the original, but also\r\n * ensures that the BaseComponent's methods are called before the subclass's. This ensures that\r\n * componentWillUnmount in the base is called and that things in the _disposables array are disposed.\r\n */\r\nfunction _makeAllSafe(obj: BaseComponent<any, any>, prototype: Object, methodNames: string[]) {\r\n  for (let i = 0, len = methodNames.length; i < len; i++) {\r\n    _makeSafe(obj, prototype, methodNames[i]);\r\n  }\r\n}\r\n\r\nfunction _makeSafe(obj: BaseComponent<any, any>, prototype: Object, methodName: string) {\r\n  let classMethod = obj[methodName];\r\n  let prototypeMethod = prototype[methodName];\r\n\r\n  if (classMethod || prototypeMethod) {\r\n    obj[methodName] = function () {\r\n      let retVal;\r\n\r\n      try {\r\n        if (prototypeMethod) {\r\n          retVal = prototypeMethod.apply(this, arguments);\r\n        }\r\n        if (classMethod !== prototypeMethod) {\r\n          retVal = classMethod.apply(this, arguments);\r\n        }\r\n      } catch (e) {\r\n        const errorMessage = `Exception in ${obj.className}.${methodName}(): ${typeof e === 'string' ? e : e.stack}`;\r\n\r\n        if (BaseComponent.onError) {\r\n          BaseComponent.onError(errorMessage, e);\r\n        }\r\n      }\r\n\r\n      return retVal;\r\n    };\r\n  }\r\n}\r\n\r\nBaseComponent.onError = (errorMessage) => {\r\n  console.error(errorMessage);\r\n  throw errorMessage;\r\n};\r\n\r\nexport function nullRender() { return null; }\r\n"],"sourceRoot":"..\\src"}